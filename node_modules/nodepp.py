# To add a new cell, type '#%%'
# To add a new markdown cell, type '#%% [markdown]'

#%% [markdown]
#
# # HW Pandas - grades
# ## By: Kismat Khatri
# ### Date: 30/10/2022
#

#%% [markdown]
# Let us improve our Stock exercise and grade conversion exercise with Pandas now.
#

#%%
import rfit
import os
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt


#%%
# Re-solve the grade-changing exercise (calculating GPA)
# First, load the data frame

dats = rfit.dfapi('Dats_grades')
rfit.dfchk(dats)


#%%
# What are the variables in the df? 
# What are the data types for these variables?
#
# The file has grades for a DATS class. Eight homeworks (out of 10 each), 2 quizzes (out of 100 each), and 2 projects (out of 100 each)
# Find out the class average for each item (HW, quiz, project)
# Hint, use .mean() function of pandas dataframe

# ######  QUESTION 1      QUESTION 1      QUESTION 1   ##########

# write your codes here
print(list(dats.columns))
print(list(dats.dtypes))
homework = dats.iloc[:,:8].mean(axis=1).mean(axis=0)
quiz = dats.iloc[:,8:10].mean(axis=1).mean(axis=0)
project = dats.iloc[:,-2:].mean(axis=1).mean(axis=0)
print(f"Average homework Score is: {homework:.2f}\nAverage quiz Score is {quiz:.2f}\nAverage project Score is {project:2f}")

# ######  END of QUESTION 1    ###   END of QUESTION 1   ##########

#%%
# create a new column right after the last hw column, to obtain the average HW grade
# for each student.
# Name column as HWavg. Make the average out of the total of 100.
# Hint: use .iloc to select the HW columns, and then use .mean(axis=1) to find the row average

# ######  QUESTION 2      QUESTION 2      QUESTION 2   ##########

# write your codes here

# ######  END of QUESTION 2    ###   END of QUESTION 2   ##########


dats['HWavg'] = dats.iloc[:,:8].mean(axis=1)
dats = dats[['H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'H7', 'H8', 'HWavg', 'Q1', 'Q2', 'Proj1', 'Proj2']]
dats.head() # check result


#%%
# The course total = 30% HW, 10% Q1, 15% Q2, 20% Proj1, 25% Proj2. 
# Calculate the total and add to the df as the last column, named 'total', out of 100 max.

# ######  QUESTION 3      QUESTION 3      QUESTION 3   ##########

# write your codes here
dats['The course Total'] = dats['HWavg']*.3 + dats.Q1*.1+ dats.Q2*.15+ dats.Proj1*.20+dats.Proj2*.25

# ######  END of QUESTION 3    ###   END of QUESTION 3   ##########

dats.head() # check result

#%%
# Now with the two new columns, calculate the class average for everything again. 

# ######  QUESTION 4      QUESTION 4      QUESTION 4   ##########

# write your codes here
HW_average = np.mean(dats.loc[:, "HWavg"])
quiz_average = dats.iloc[:, 9:11].mean(axis=1).mean(axis=0)
project_average = dats.iloc[:, 11:13].mean(axis=1).mean(axis=0)
total_average = np.mean(dats.loc[:, 'The course Total'])
print("Home work average is: ", HW_average)
print("Quiz Average is: ", quiz_average)
print("Project Average is: ", project_average)
print("Total average is :", total_average )
print(f"The Class Average is: {dats['The course Total'].mean():.2f}")
# ######  END of QUESTION 4    ###   END of QUESTION 4   ##########

#%%
# Save out your dataframe as a csv file
# import os

# ######  QUESTION 5      QUESTION 5      QUESTION 5   ##########

# write your codes here
dats.to_csv('datsfinaldataframe', index=False, header=True)
# ######  END of QUESTION 5    ###   END of QUESTION 5   ##########



#%%
# Finally, re-solve our homework exercise for calculating GPA using functions, but with a dataframe now.
# In Week03 hw, we wrote a function to convert course total to letter grades. You can use your own, or the one from the solution file here.
def find_grade(total):
  # write an appropriate and helpful docstring
  """
  convert total score into grades
  :param total: 0-100 
  :return: str
  """
  # ######  QUESTION 6      QUESTION 6      QUESTION 6   ##########

  # copy your codes here, either from your Week03 hw, or the solution file
  grade = 0
  grade = 'A' if total>=93 else 'A-' if total >= 90 else 'B+' if total >= 87 else 'B' if total >= 83 else 'B-' if total >=80 else 'C+' if total >= 77 else 'C' if total >= 73 else 'C-' if total >=70 else 'D' if total >=60 else 'F' 

  # ######  END of QUESTION 6    ###   END of QUESTION 6   ##########
  return grade  

#%%
# Using the .apply() method in Pandas
# 
# Let us create one more column for the letter grade, just call it grade.
# Instead of broadcasting some calculations on the dataframe directly, we need to apply (instead of broadcast) this find_grade() 
# function on all the elements in the total column
# ######  QUESTION 7      QUESTION 7      QUESTION 7   ##########

# write your code using the .apply() function to obtaine a new column of letter grade (call that new column 'grade') from the total.
dats['grade'] = dats['The course Total'].apply(find_grade)
dats.head()
# ######  END of QUESTION 7    ###   END of QUESTION 7   ##########



#%%

